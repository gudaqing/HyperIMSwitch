<Page
    x:Class="HyperIMSwitch.UI.SettingsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:HyperIMSwitch.UI"
    xmlns:vm="using:HyperIMSwitch.UI.ViewModels"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
    <Grid x:Name="LayoutRoot" Padding="24" RowSpacing="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Spacing="8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="HyperIMSwitch"
                           Style="{ThemeResource TitleTextBlockStyle}"
                           VerticalAlignment="Center"/>
                <Button x:Name="AddRowButton"
                        Grid.Column="1"
                        Content="+ 添加绑定 / Add"
                        Click="AddRowButton_Click"/>
            </Grid>
            <TextBlock Text="IME 热键切换工具 / IME Hotkey Switcher"
                       Style="{ThemeResource SubtitleTextBlockStyle}"
                       Opacity="0.6"/>
        </StackPanel>

        <!-- Scrollable middle content -->
        <ScrollViewer Grid.Row="1">
            <StackPanel x:Name="RootPanel" Spacing="12">
                <!-- Dynamic binding rows -->
                <ItemsControl x:Name="BindingRowsControl">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate x:DataType="vm:BindingRowViewModel">
                            <Border Background="{ThemeResource ControlFillColorDefaultBrush}"
                                    CornerRadius="8" Padding="12" Margin="0,0,0,8">
                                <Grid ColumnSpacing="8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <ComboBox Grid.Column="0" Grid.Row="0"
                                              HorizontalAlignment="Stretch"
                                              ItemsSource="{x:Bind AvailableProfiles}"
                                              SelectedItem="{x:Bind SelectedProfile, Mode=TwoWay}"
                                              DisplayMemberPath="DisplayName"
                                              PlaceholderText="选择输入法 / Select IME"/>

                                    <local:HotkeyEditorControl Grid.Column="1" Grid.Row="0"
                                                               Binding="{x:Bind Binding}"
                                                               HotkeyChanged="HotkeyEditorControl_HotkeyChanged"/>

                                    <Button Grid.Column="2" Grid.Row="0"
                                            Content="×"
                                            Command="{x:Bind RemoveCommand}"
                                            VerticalAlignment="Center"/>

                                    <Grid Grid.Column="0" Grid.Row="1"
                                          Margin="18,6,0,0"
                                          Visibility="{x:Bind ShowModeSelector, Mode=OneWay}">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <TextBlock Grid.Row="0"
                                                   Margin="2,0,0,4"
                                                   Opacity="0.65"
                                                   Text="模式 / Mode"/>

                                        <ComboBox Grid.Row="1"
                                                  HorizontalAlignment="Stretch"
                                                  ItemsSource="{x:Bind AvailableModes}"
                                                  SelectedItem="{x:Bind SelectedMode, Mode=TwoWay}"
                                                  DisplayMemberPath="DisplayName"
                                                  PlaceholderText="输入模式 / Conversion Mode"/>
                                    </Grid>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <Border Background="{ThemeResource ControlFillColorDefaultBrush}"
                        CornerRadius="8" Padding="16">
                    <ToggleSwitch x:Name="AutoStartToggle"
                                  Header="开机自启 / Auto Start on Login"/>
                </Border>

                <Expander x:Name="DetectedImeExpander"
                          Header="已检测到的输入法 / Detected IMEs"
                          HorizontalAlignment="Stretch"
                          HorizontalContentAlignment="Stretch"
                          IsExpanded="False">
                    <ListView x:Name="ProfilesList" MaxHeight="180"/>
                </Expander>
            </StackPanel>
        </ScrollViewer>

        <!-- Fixed bottom actions -->
        <StackPanel Grid.Row="2" Spacing="6" HorizontalAlignment="Right">
            <StackPanel Orientation="Horizontal" Spacing="10">
                <TextBlock x:Name="StatusText"
                           VerticalAlignment="Center"
                           Foreground="{ThemeResource SystemFillColorSuccessBrush}"/>
            </StackPanel>
        </StackPanel>
    </Grid>
</Page>
