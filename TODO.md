# TODO - HyperIMSwitch Roadmap

## 1. 目标
- 做成通用输入法切换工具，优先保证“切换到目标输入法”稳定。
- 在此基础上，对有特有模式的语言（优先 CJK）提供可选增强。

## 2. 当前结论（已验证）
- 热键监听与注册链路正常。
- `ITfInputProcessorProfileMgr` 在当前环境不兼容，已改为 `ITfInputProcessorProfiles` 路径。
- 当前环境下 IME 切换关键步骤是：
  - 首调失败后执行 `ChangeCurrentLanguage`
  - 再 `ActivateLanguageProfile(Retry)` 成功
- 日语模式下拉当前为写死值，不是系统动态枚举。

## 3. 架构方向
- 核心层（通用）：仅负责 profile 切换与最小重试链。
- 能力层（语言特化）：按语言/IME 提供“附加模式控制”。
- 回退层（兜底）：无特化能力时仅做切换，不影响主功能。

## 4. 里程碑

### M1: 稳定核心（优先）
- [ ] 收敛 IME 重试链到最小必要步骤（保留开关以便回滚）。
- [ ] 清理启动时强制覆盖诊断配置的逻辑（避免覆盖用户设置）。
- [ ] 降低噪声日志级别，保留关键错误与诊断模式日志。

### M2: 能力抽象
- [ ] 引入 `IInputModeProvider`（或同等接口）抽象语言特化模式。
- [ ] 先迁移日语实现为 `JapaneseModeProvider`。
- [ ] UI 按 provider 动态展示模式下拉；无 provider 则隐藏。

### M3: 扩展语言
- [ ] 增加韩语 provider（Hangul/Alnum 基础能力）。
- [ ] 评估中文 IME（微软拼音/五笔/微信）是否可做统一模式抽象。
- [ ] 对第三方 IME 不可控能力保留“仅切换”策略。

## 5. 测试计划
- [ ] 前台应用矩阵：Sublime / VS / Windows Terminal / 浏览器 / 聊天应用。
- [ ] 场景矩阵：`0409 -> 0411 -> 0804`、`0804 -> 0409 -> 0411`。
- [ ] 验证项：
  - [ ] 热键触发
  - [ ] 切换成功率
  - [ ] 模式落地（如日语默认平假名）
  - [ ] 延迟与稳定性（多次连续切换）

## 6. 文档与可维护性
- [ ] 保留并更新 `SWITCH_DEBUG_REPORT.md`（每次关键策略变更后更新）。
- [ ] 增加面向用户的配置说明（常见语言推荐配置）。
- [ ] 记录已知限制（不同 IME/不同应用行为差异）。

## 7. 风险与开放问题
- 不同 IME 对模式控制接口支持差异很大，难以完全统一。
- 同一 IME 在不同前台应用下行为可能不同。
- 是否默认启用“保守兼容链”还是“最小链”，需要产品策略决定。
